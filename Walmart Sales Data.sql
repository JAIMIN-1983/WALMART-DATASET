CREATE DATABASE WALMART_SALES_DATA;
USE WALMART_SALES_DATA;

CREATE TABLE IF NOT EXISTS WALMART (
INVOICE_ID VARCHAR(100),
BRANCH VARCHAR(10),
CITY VARCHAR(80),
CUSTOMER VARCHAR(100),
GENDER VARCHAR(30),
PRODUCT_LINE VARCHAR(100),
UNIT_PRICE DECIMAL(20,2),
QUANTITY INT,
TAX_5_PERNT DECIMAL(20,4),
TOTAL DECIMAL(40,4),
`DATE` VARCHAR(100),
`TIME` TIME,
PAYMENT VARCHAR(40),
COGS FLOAT(100,4),
GROSS_MARGIN DECIMAL(20,10),
GROSS_INCOME DECIMAL(20,10),
RATING DECIMAL(10,2));

LOAD DATA INFILE
'E:/WalmartSalesData.csv'
INTO TABLE WALMART
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;

SELECT * FROM WALMART;
DROP TABLE WALMART;

/* Q-1 UPDATE TIME INTO MORNING AND AFTERNOON */
ALTER TABLE WALMART
ADD COLUMN TIME_TYPE VARCHAR(30) NOT NULL AFTER TIME;
UPDATE WALMART
SET TIME_TYPE = 'MORNING' WHERE TIME < '12:00:00'; 
UPDATE WALMART
SET TIME_TYPE = 'AFTERNOON' WHERE TIME > '12:00:00'; /* Answer is ok */

SELECT * FROM WALMART;

SELECT *,
CASE
WHEN `TIME` >= "00:00" AND `TIME` < "12:00" THEN "MORNING"
WHEN `TIME` > "12:00" THEN "AFTERNOON"
ELSE 0
END AS STATEMENT
FROM WALMART; /* Answer is ok */

/* Q-2 UPDATE DAYNAME AND MONTHNAME */
ALTER TABLE WALMART
ADD COLUMN `DAYNAME` VARCHAR(30) AFTER DATE;
UPDATE WALMART
SET `DAYNAME` = dayname(`DATE`); /* Answer is ok */

SELECT * FROM WALMART;

ALTER TABLE WALMART
ADD COLUMN `MONTHNAME` VARCHAR(30) AFTER DATE;
UPDATE WALMART
SET `MONTHNAME` = MONTHNAME(`DATE`); /* Answer is Ok */

SELECT * FROM WALMART;

ALTER TABLE WALMART
DROP COLUMN MONTHNAME;
/* Q-3 How many unique cities does the data have? */
SELECT DISTINCT(CITY) FROM WALMART; /* Answer is ok */
SELECT COUNT(DISTINCT(CITY)) FROM WALMART; 
SELECT DISTINCT city FROM sales;
/* Q-4 In which city is each branch? */
SELECT DISTINCT(CITY), BRANCH FROM WALMART WHERE BRANCH IN('A','B','C') AND CITY IN('Yangon','Mandalay','Naypyitaw'); /* Answer is ok */
SELECT DISTINCT city, branch FROM WALMART; /* Answer is ok */
/* Q-5 How many unique product lines does the data have? */
SELECT DISTINCT(PRODUCT_LINE) FROM WALMART; /* Answer is ok */
SELECT COUNT(DISTINCT(PRODUCT_LINE)) FROM WALMART;
SELECT DISTINCT product_line FROM sales;
/* Q-6  Which is the most selling product line? */
SELECT PRODUCT_LINE, MAX(QUANTITY) AS MOST_SELLING_PRODUCT_LINE FROM WALMART GROUP BY PRODUCT_LINE ORDER BY MOST_SELLING_PRODUCT_LINE DESC LIMIT 1; /* Answer is ok */
SELECT SUM(QUANTITY) as QTY, PRODUCT_LINE FROM WALMART GROUP BY PRODUCT_LINE ORDER BY QTY DESC LIMIT 1; /* Answer is ok */
/* Q-7 What is the total revenue by month? */
SELECT `MONTHNAME`, SUM(TOTAL) AS TOTAL_REVENUE FROM WALMART GROUP BY `MONTHNAME` ORDER BY TOTAL_REVENUE; /* Answer is ok */
SELECT month_name AS month, SUM(total) AS total_revenue FROM sales GROUP BY month_name ORDER BY total_revenue;
/* Q-8 Which month had the largest COGS? */
SELECT `MONTHNAME`, MAX(COGS) AS LARGEST_COGS FROM WALMART GROUP BY `MONTHNAME` ORDER BY LARGEST_COGS DESC LIMIT 1; /* Answer is ok */
SELECT month_name AS month, SUM(cogs) AS cogs FROM sales GROUP BY month_name ORDER BY cogs LIMIT 1;
/* Q-9 Which product line had the largest revenue? */
SELECT PRODUCT_LINE, MAX(TOTAL) AS LARGEST_REVENUE FROM WALMART GROUP BY PRODUCT_LINE ORDER BY LARGEST_REVENUE DESC LIMIT 1; /* Answer is ok*/
SELECT product_line, SUM(total) as total_revenue FROM sales GROUP BY product_line ORDER BY total_revenue DESC LIMIT 1;
/* Q-10 Which is the city with the largest revenue? */
SELECT CITY, MAX(TOTAL) AS LARGEST_REVENUE FROM WALMART GROUP BY CITY ORDER BY LARGEST_REVENUE DESC LIMIT 1; /* Answer is ok*/
SELECT branch, city, SUM(total) AS total_revenue FROM sales GROUP BY city, branch  ORDER BY total_revenue DESC LIMIT 1;
/* Q-11 Fetch each product line and add a column to those product line showing "Good", "Bad". Good if its greater than average sales */
SELECT AVG(QUANTITY) FROM WALMART; /* Average quantity value with this rsult grid is 5.510 */

ALTER TABLE WALMART
ADD COLUMN INFORMATION VARCHAR(30) NOT NULL AFTER QUANTITY; 
SELECT INVOICE_ID, CUSTOMER, GENDER, CITY, PRODUCT_LINE, QUANTITY, IF(QUANTITY > (SELECT avg(QUANTITY) FROM WALMART),'GOOD','BAD') AS ANALYSIS
FROM WALMART GROUP BY INVOICE_ID, CUSTOMER, GENDER, CITY, PRODUCT_LINE, QUANTITY;
UPDATE WALMART
SET INFORMATION = IF(QUANTITY > ('5.510'),'GOOD', 'BAD'); /* Answer is ok */

SELECT * FROM WALMART;

SELECT *,
CASE
WHEN QUANTITY > (SELECT AVG(QUANTITY) FROM WALMART) THEN "GOOD"
WHEN QUANTITY < (SELECT AVG(QUANTITY) FROM WALMART) THEN "BAD"
ELSE 0
END AS ANALYSIS
FROM WALMART;

SELECT * FROM WALMART;

SELECT AVG(quantity) AS avg_qnty FROM sales;
SELECT product_line, CASE WHEN AVG(quantity) > 6 THEN "Good" ELSE "Bad" END AS remark FROM sales GROUP BY product_line;
/* Q-12 Which branch sold more products than average product sold? */
SELECT BRANCH, CITY, CUSTOMER, GENDER, PRODUCT_LINE, QUANTITY FROM WALMART WHERE QUANTITY > (SELECT AVG(QUANTITY) FROM WALMART); /* Answer is ok */
SELECT BRANCH, SUM(QUANTITY) AS QTY FROM WALMART GROUP BY BRANCH HAVING SUM(QUANTITY) > (SELECT AVG(QUANTITY) FROM WALMART); /* Answer is ok */
/* Q-13 What is the most common product line by gender? */
SELECT PRODUCT_LINE, GENDER, MAX(QUANTITY) AS MOST FROM WALMART GROUP BY PRODUCT_LINE, GENDER ORDER BY MAX(QUANTITY) DESC LIMIT 1; /* Answer is ok */
SELECT PRODUCT_LINE, GENDER, COUNT(GENDER) AS TOTAL_COUNT FROM WALMART GROUP BY PRODUCT_LINE, GENDER ORDER BY TOTAL_COUNT DESC LIMIT 1; /* Answer is ok */
SELECT gender, product_line, COUNT(gender) AS total_cnt FROM sales GROUP BY gender, product_line ORDER BY total_cnt DESC;
/* Q-14 What is the average rating of each product line? */
SELECT PRODUCT_LINE, AVG(RATING) AS AVERAGE_RATING FROM WALMART GROUP BY PRODUCT_LINE ORDER BY AVERAGE_RATING; /* Answer is ok */
SELECT ROUND(AVG(rating), 2) as avg_rating, product_line FROM sales GROUP BY product_line ORDER BY avg_rating DESC;
/* Q-15 How many unique customer types does the data have? */
SELECT DISTINCT(CUSTOMER) AS UNIQUE_CUSTOMER FROM WALMART; /* Answer is ok */
SELECT DISTINCT customer_type FROM sales;
/* Q-16 How many unique payment methods does the data have? */
SELECT DISTINCT(PAYMENT) AS UNIQUE_PAYMENT FROM WALMART; /* Answer is ok */
SELECT DISTINCT payment FROM sales;
/* Q-17 What is the most common customer type? */
SELECT CUSTOMER AS CUSTOMER_TYPE, COUNT(*) AS COUNT FROM WALMART GROUP BY CUSTOMER_TYPE ORDER BY COUNT DESC LIMIT 1; /* Answer is ok */
SELECT customer_type, count(*) as count FROM sales GROUP BY customer_type ORDER BY count DESC;
/* Q-18  What is the gender distribution per branch? */
SELECT BRANCH, COUNT(GENDER) AS GENDER_DISTRIBUTION FROM WALMART GROUP BY BRANCH; /* Answer is ok */
SELECT GENDER, COUNT(*) as GENDER_COUNT FROM WALMART WHERE BRANCH = "C" GROUP BY GENDER ORDER BY GENDER_COUNT DESC; /* Answer is ok */
/* Q-19 Which time of the day do customers give most ratings? */
SELECT TIME, MAX(RATING) AS MOST_RATING FROM WALMART GROUP BY TIME; /* Answer is ok */
SELECT TIME, RATING AS MOST_RATING FROM WALMART WHERE RATING = 10;
SELECT TIME, RATING AS MOST_RATING FROM WALMART WHERE RATING = (SELECT MAX(RATING) FROM WALMART);
SELECT time_day, AVG(rating) AS avg_rating FROM sales GROUP BY time_day ORDER BY avg_rating DESC;
/* Q-20 Which time of the day do customers give most ratings per branch? */
SELECT TIME, BRANCH, MAX(RATING) AS MOST_RATING FROM WALMART GROUP BY TIME, BRANCH ORDER BY MOST_RATING; /* Answer is ok */
SELECT TIME, RATING AS MOST_RATING, BRANCH FROM WALMART WHERE RATING = 10 AND BRANCH IN('A','B','C');
SELECT time_day, AVG(rating) AS avg_rating FROM sales WHERE branch = "A" GROUP BY time_day ORDER BY avg_rating DESC;
/* Q-21 Which day fo the week has the best avg ratings? */
SELECT `DAYNAME`, AVG(RATING) AS BEST_AVG_RATING FROM WALMART GROUP BY `DAYNAME` ORDER BY BEST_AVG_RATING DESC LIMIT 1; /* Answer is ok */
SELECT day_name, COUNT(day_name) total_sales FROM sales WHERE branch = "C" GROUP BY day_name ORDER BY total_sales DESC;
/* Q-22 Which day of the week has the best average ratings per branch? */
SELECT `DAYNAME`, BRANCH, AVG(RATING) AS BEST_AVERAGE_RATINGS FROM WALMART GROUP BY `DAYNAME`, BRANCH ORDER BY BEST_AVERAGE_RATINGS DESC LIMIT 3; /* Answer is ok */
/* Q-23 Number of sales made in each time of the day per weekday */
ALTER TABLE WALMART
ADD COLUMN `WEEKDAY` VARCHAR(30) NOT NULL AFTER DATE;
UPDATE WALMART
SET `WEEKDAY` = weekday(`DATE`);
SELECT * FROM WALMART;
SELECT `WEEKDAY`, `TIME`, TOTAL AS SALES FROM WALMART WHERE `WEEKDAY` <= 5; /* Answer is ok */
SELECT * FROM WALMART;
SELECT time_day, COUNT(*) AS total_sales FROM sales WHERE day_name = "Sunday" GROUP BY time_day ORDER BY total_sales DESC;
/* Q-24 Which of the customer types brings the most revenue? */
SELECT CUSTOMER, MAX(TOTAL) AS REVENUE FROM WALMART GROUP BY CUSTOMER ORDER BY REVENUE DESC LIMIT 1; /* Answer is ok */
SELECT customer_type, SUM(total) AS total_revenue FROM sales GROUP BY customer_type ORDER BY total_revenue;
/* Q-25 Which city has the largest tax/VAT percent? */
SELECT CITY, MAX(TAX_5_PERNT) AS LARGEST_TAX FROM WALMART GROUP BY CITY ORDER BY LARGEST_TAX DESC LIMIT 1; /* Answer is ok */
SELECT city, ROUND(AVG(tax_pct), 2) AS avg_tax_pct FROM sales GROUP BY city ORDER BY avg_tax_pct DESC;
/* Q-26 Which customer type pays the most in VAT? */
SELECT CUSTOMER, MAX(TAX_5_PERNT) AS MOST_IN_VAT FROM WALMART GROUP BY CUSTOMER ORDER BY MOST_IN_VAT DESC LIMIT 1; /* Answer is ok */
SELECT customer_type, AVG(tax_pct) AS total_tax FROM sales GROUP BY customer_type ORDER BY total_tax; 


 /* Extra Questions */
 /* Add time of the day column */
 SELECT TIME,
 (CASE
	  WHEN TIME BETWEEN '00:00:00' AND '12:00:00' THEN 'Morning'
      WHEN TIME BETWEEN '12:01:00' AND '16:00:00' THEN 'Afternoon'
      ELSE 'Evening'
      END) AS TIME_OF_DAY
FROM WALMART;

ALTER TABLE WALMART
ADD COLUMN TIME_OF_DAY VARCHAR(20);
UPDATE WALMART SET TIME_OF_DAY  = (
CASE
	WHEN TIME BETWEEN '00:00:00' AND '12:00:00' THEN 'Morning'
	WHEN TIME BETWEEN '12:01:00' AND '16:00:00' THEN 'Afternoon'
	ELSE 'Evening'
      END);
SELECT * FROM WALMART;
/* Which is the city with largest revenue? */
SELECT CITY, SUM(TOTAL) AS LARGEST_REVENUE FROM WALMART GROUP BY CITY ORDER BY LARGEST_REVENUE;
/* What is the most common product line by Gender? */
SELECT GENDER, PRODUCT_LINE, COUNT(GENDER) AS TOTAL_COUNT FROM WALMART GROUP BY GENDER, PRODUCT_LINE ORDER BY TOTAL_COUNT DESC;
/* What is the average rating for each product line? */
SELECT PRODUCT_LINE AS PRODUCT, ROUND(AVG(RATING),2) AS AVG_RATING FROM WALMART GROUP BY PRODUCT_LINE ORDER BY AVG_RATING DESC;
/* What is gender count of Customers? */
SELECT GENDER, COUNT(*) AS GENDER_COUNT FROM WALMART GROUP BY GENDER ORDER BY GENDER_COUNT DESC;
/* What is the gender distribution per branch? */
SELECT GENDER, BRANCH, COUNT(*) AS GENDER_DISTRIBUTION FROM WALMART GROUP BY GENDER, BRANCH ORDER BY BRANCH;
/* Which time of the day do customers give most rating per branch? */
SELECT BRANCH, TIME_TYPE, ROUND(AVG(RATING),2) AS AVG_RATING FROM WALMART GROUP BY BRANCH, TIME_TYPE ORDER BY AVG_RATING DESC;
/* Which day of the week has the best average rating? */ 
SELECT DAYNAME, ROUND(AVG (RATING),2) AS AVG_RATING FROM WALMART GROUP BY DAYNAME ORDER BY AVG_RATING DESC;
/* Which day of the week has the best average ratings per branch? */
SELECT BRANCH, DAYNAME, ROUND(AVG(RATING),2) AS AVG_RATING FROM WALMART GROUP BY BRANCH, DAYNAME ORDER BY AVG_RATING DESC;